% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/scan_utilities.R
\name{drill_down_scan}
\alias{drill_down_scan}
\title{Recursive Drill-Down over Candidate Predictor Sets}
\usage{
drill_down_scan(
  df,
  verdict,
  importances,
  layer_level,
  removable_predictors,
  ntree = 500,
  verbose = FALSE,
  fixed_outcome,
  always_predictors = NULL,
  quantitative_thr = 40,
  categorical_thr = 35,
  importance_method = c("fixed", "neg_exp", "net_clust"),
  prob = 0.75,
  acc = NULL
)
}
\arguments{
\item{df}{Data frame with predictors and the fixed outcome column.}

\item{verdict}{Named numeric vector of current best relations with their entropy
(e.g., \code{"X + Y → Z" = 0.42}). Passed forward and extended during drilling.}

\item{importances}{List accumulating variable-importance structures per layer.
Typically starts from the first-layer importances returned by
\code{causal_entropy_combinations()}.}

\item{layer_level}{Integer index of the current drill layer (e.g., 1 for the first drill step).}

\item{removable_predictors}{Character vector of predictors deemed removable at this step.}

\item{ntree}{Integer. Number of trees for the underlying Random Forest (default \code{500}).}

\item{verbose}{Logical. Print step-by-step diagnostics (default \code{FALSE}).}

\item{fixed_outcome}{Character scalar. The outcome variable name kept fixed during drilling.}

\item{always_predictors}{Optional character vector of predictors that must always be included.}

\item{quantitative_thr}{Numeric. Threshold for quantitative variables (importance-based pruning).}

\item{categorical_thr}{Numeric. Threshold for categorical variables (importance-based pruning).}

\item{importance_method}{One of \code{"fixed"}, \code{"neg_exp"}, \code{"net_clust"}.
Strategy used by \code{evaluate_importance()} to decide removability.}

\item{prob}{Numeric. Probability cutoff for the neural network inside
\code{evaluate_importance()} when \code{importance_method = "net_clust"} (default \code{0.75}).}

\item{acc}{Environment used as an accumulator to propagate stop conditions
across recursive calls. Usually left as \code{NULL} by the user.}
}
\value{
A (possibly nested) list with elements:
\itemize{
\item \code{statistic}: numeric scalar, entropy of the winning combination at this layer;
\item \code{decision}: character, relation label of the winner (e.g., \code{"X + Y → Z"});
\item \code{data}: data frame of the winner's predictors + outcome;
\item \code{verdict}: named numeric vector of surviving candidates and entropies;
\item \code{importances}: list accumulating per-layer importances;
\item \code{last_layer}: integer, index of the last processed layer;
\item \code{drill_down}: recursive result for the next layer (or \code{NULL} if no further drilling).
}
}
\description{
Starting from a current best relation, iteratively explores reduced predictor
subsets (removing only those marked as \emph{removable}) to seek higher-entropy
combinations for a fixed outcome. At each step it re-fits the causal model and
keeps track of entropy gains and importances across layers.
}
\details{
For each removable predictor, the function fits \code{causal_entropy_combinations()}
on the remaining set and compares entropies, keeping the best. Importances for the
winning subset are then re-evaluated via \code{evaluate_importance()} to decide the
next removable set, and the procedure recurses until stopping criteria are met.
If at any step all predictors are deemed removable, the drill-down halts and the
root result is discarded to avoid trivial models.
}
\examples{
\dontrun{
res <- drill_down_scan(
  df = mydata,
  verdict = c("A + B → Y" = 0.37),
  importances = list(n1th_layer = my_first_layer_imps),
  layer_level = 1,
  removable_predictors = c("A"),
  ntree = 500,
  verbose = TRUE,
  fixed_outcome = "Y",
  always_predictors = NULL,
  quantitative_thr = 40,
  categorical_thr = 35,
  importance_method = "neg_exp",
  prob = 0.75
)
}

}
\seealso{
\code{\link{scan_all_outcomes_complete}}, \code{\link{evaluate_importance}},
\code{\link{causal_entropy_combinations}}
}
